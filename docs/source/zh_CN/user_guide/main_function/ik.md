# ğŸ¦¾ åå‘è¿åŠ¨å­¦ï¼ˆIKï¼‰

MotrixSim æä¾›äº†ä¸€ä¸ªé«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„åå‘è¿åŠ¨å­¦ï¼ˆIKï¼‰æ±‚è§£å™¨ï¼Œä½äº`motrixsim.ik`æ¨¡å—ä¸­ã€‚
ç›®å‰æ”¯æŒåŸºäºé«˜æ–¯-ç‰›é¡¿æ³•çš„ IK æ±‚è§£å™¨ï¼ˆ[`GaussNewtonSolver`]ï¼‰å’Œç®€å•çš„ IK é“¾æ¨¡å‹ï¼ˆ[`IkChain`]ï¼‰ã€‚

```{video} /_static/videos/ik.mp4
:nocontrols:
:autoplay:
:playsinline:
:muted:
:loop:
:width: 100%
```

## åŸºæœ¬æ¦‚å¿µ

Inverse Kinematics (IK) æ˜¯è®¡ç®—æœºå™¨äººæœ«ç«¯æ‰§è¡Œå™¨ï¼ˆå¦‚æœºæ¢°è‡‚æ‰‹çˆªï¼‰ä½ç½®å’Œå§¿æ€æ‰€éœ€çš„å…³èŠ‚å‚æ•°çš„è¿‡ç¨‹ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯æ­£å‘è¿åŠ¨å­¦ï¼ˆForward Kinematicsï¼‰ï¼Œå®ƒæ˜¯é€šè¿‡å·²çŸ¥çš„å…³èŠ‚å‚æ•°æ¥è®¡ç®—æœ«ç«¯æ‰§è¡Œå™¨çš„ä½ç½®å’Œå§¿æ€ã€‚
ç”¨ä¸€ä¸ªå…¬å¼æ¥è¡¨ç¤º IK è®¡ç®—è¿‡ç¨‹å°±æ˜¯: `joint_dof_pos = compute_inverse_kinematic(ik_model, end_effector_pose)`ã€‚

## IK Model

IK æ¨¡å‹ç”¨äºå®šä¹‰ IK é—®é¢˜çš„ç»“æ„å’Œçº¦æŸã€‚å½“å‰ MotrixSim ä»…æ”¯æŒç”±å•è‡ªç”±åº¦å…³èŠ‚(Hinge,Slide)ç»„æˆçš„é“¾å¼ç»“æ„(IKChain)ã€‚

### IK Chain

IK é“¾æ¨¡å‹ç”±ä¸€ç³»åˆ—è¿æ¥çš„å…³èŠ‚å’Œä¸€ä¸ªæœ«ç«¯æ‰§è¡Œå™¨ç»„æˆ, å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ikchain](/_static/images/ikchain.png)

åœ¨ MotrixSim ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºä¸€ä¸ª IK é“¾æ¨¡å‹ï¼š

```{literalinclude} ../../../../examples/ik.py
:language: python
:dedent:
:start-after: "# tag::create_ik_chain"
:end-before:  "# end::create_ik_chain"
```

ä»¥ä¸Šä»£ç é€šè¿‡æŒ‡å®šæœ«ç«¯è¿æ†å’Œå¯é€‰çš„èµ·å§‹è¿æ†æ¥åˆ›å»ºä¸€ä¸ª IK é“¾æ¨¡å‹ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡ `end_effector_offset` å‚æ•°æ¥å®šä¹‰æœ«ç«¯æ‰§è¡Œå™¨ç›¸å¯¹äºæœ«ç«¯è¿æ†çš„åç§»ã€‚

æ‚¨å¯ä»¥æŸ¥çœ‹ API æ–‡æ¡£äº†è§£æ›´å¤šå…³äº [`IkChain`] çš„ä¿¡æ¯ã€‚

## IK Solver

åœ¨å®šä¹‰äº† IKModel ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ IK Solver æ¥åšå…·ä½“çš„ IK æ±‚è§£å·¥ä½œã€‚MotrixSim ç›®å‰æ”¯æŒåŸºäºé«˜æ–¯-ç‰›é¡¿æ³•çš„ IK æ±‚è§£å™¨[`GaussNewtonSolver`]ã€‚

### Gauss-Newton IK Solver

é«˜æ–¯-ç‰›é¡¿æ³•æ˜¯ä¸€ç§ç”¨äºéçº¿æ€§æœ€å°äºŒä¹˜é—®é¢˜çš„è¿­ä»£ä¼˜åŒ–ç®—æ³•ã€‚å®ƒé€šè¿‡çº¿æ€§åŒ–éçº¿æ€§å‡½æ•°å¹¶ä½¿ç”¨æœ€å°äºŒä¹˜æ³•æ¥æ›´æ–°å‚æ•°ä¼°è®¡ï¼Œä»è€Œé€æ­¥é€¼è¿‘ç›®æ ‡å€¼ã€‚åœ¨ IK æ±‚è§£ä¸­ï¼Œé«˜æ–¯-ç‰›é¡¿æ³•é€šè¿‡è¿­ä»£è°ƒæ•´å…³èŠ‚å‚æ•°ï¼Œä½¿å¾—æœ«ç«¯æ‰§è¡Œå™¨çš„ä½ç½®å’Œå§¿æ€å°½å¯èƒ½æ¥è¿‘ç›®æ ‡ä½ç½®å’Œå§¿æ€ã€‚

åœ¨ MotrixSim ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºä¸€ä¸ªé«˜æ–¯-ç‰›é¡¿ IK æ±‚è§£å™¨ï¼š

```{literalinclude} ../../../../examples/ik.py
:language: python
:dedent:
:start-after: "# tag::create_ik_solver"
:end-before:  "# end::create_ik_solver"
```

ç„¶åé€šè¿‡è°ƒç”¨ `solve` æ–¹æ³•æ¥æ‰§è¡Œ IK æ±‚è§£ï¼š

```{literalinclude} ../../../../examples/ik.py
:language: python
:dedent:
:start-after: "# tag::solve_ik"
:end-before:  "# end::solve_ik"
```

solve æ–¹æ³•è¿”å› numpy.ndarray å¯¹è±¡ï¼Œå…¶å½¢çŠ¶ä¸º`(*data.shape, chain.num_dof_pos + 2)`. å…¶ä¸­ `chain.num_dof_pos` æ˜¯ IK é“¾çš„è‡ªç”±åº¦æ•°é‡ï¼Œé¢å¤–çš„ä¸¤ä¸ªå…ƒç´ åˆ†åˆ«è¡¨ç¤ºæ±‚è§£å™¨çš„æ”¶æ•›çŠ¶æ€å’Œè¿­ä»£æ¬¡æ•°ã€‚

```{note}
IK Solveråœ¨è¿›è¡Œæ±‚è§£æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æ— æ³•æ”¶æ•›çš„æƒ…å†µï¼ŒåŸå› æ˜¯å¤šæ ·çš„ï¼Œä¾‹å¦‚:

- ç›®æ ‡ä½ç½®è¶…å‡ºäº†æœºæ¢°è‡‚çš„å·¥ä½œç©ºé—´
- IKè¿‡ç¨‹å¹¶æ²¡æœ‰è€ƒè™‘ç¢°æ’ç­‰é™åˆ¶
- æœºæ¢°è‡‚çš„åˆå§‹å§¿æ€è·ç¦»ç›®æ ‡ä½ç½®è¿‡è¿œï¼Œæ— æ³•åœ¨è®¾å®šçš„è¿­ä»£æ¬¡æ•°å†…æ”¶æ•›
- ....

```

_æŸ¥çœ‹å®Œæ•´ä»£ç è¯·è§ [examples/ik.py](../../../../examples/ik.py)_

[`IkChain`]: motrixsim.ik.IkChain
[`GaussNewtonSolver`]: motrixsim.ik.GaussNewtonSolver
